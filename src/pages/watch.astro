---
import Layout from '@/layouts/Layout.astro'
import { Watch as WatchCentralizedComponent } from '@/components/Watch/Watch'
import { Player } from '@/components/Player/Player'
import { AUTO_PLAY } from '@/lib/constants'
import { Menu } from '@/components/Menu/Menu'
import { getPoster } from '@/services/videoService'

export const prerender = false

const id = Astro.url.searchParams.get('v')
if (!id) {
  return Astro.redirect('/')
}
---

<Layout useTransitions links={[
  { rel: 'preload', as: 'image', href: getPoster(id), fetchpriority: 'high', ['data-link-id']: 'custom-link' }
]}>
  <Menu client:load transition:persist />
  <WatchCentralizedComponent id={id} client:load>
    <Player
      class='flex justify-center w-full h-fit cinema:h-full max-w-full max-h-full select-none'
      videoId={id}
      autoplay={AUTO_PLAY}
      client:load
      transition:persist
    />
  </WatchCentralizedComponent>
</Layout>