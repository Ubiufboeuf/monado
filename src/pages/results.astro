---
import { Menu } from '@/components/Menu/Menu'
import { MenuMini } from '@/components/Menu/MenuMini'
import { VideoCard } from '@/components/VideoCard'
import { VideoListCard } from '@/components/VideoListCard'
import Layout from '@/layouts/Layout.astro'
import { search } from '@/services/searchService'
import type { Video } from '@/types/videoTypes'

const { pathname, searchParams } = Astro.url
const query = searchParams.get('search')

if (!query) return Astro.redirect('/')

let videos: Video[] = []
try {
  videos = await search(query)
} catch (err) {
  console.error(`Error buscando "${query}" |`, err)
}
---

<Layout>
  <Menu pathname={pathname} client:load transition:persist />
  <MenuMini client:load />
  <section class='absolute top-17 right-0 flex flex-col h-[calc(100%-112px)] min-h-fit w-full sm:w-[calc(100%-72px)] ml:menu-open:w-navbar pb-6 [transition:width_250ms_ease]'>
    <div class='w-full'>
      { videos.map((v) => (
        <VideoListCard video={v} client:load />
      )) }
    </div>
  </section>
</Layout>