---
import { Menu } from '@/components/Menu/Menu'
import { MenuMini } from '@/components/Menu/MenuMini'
import { SearchResults } from '@/components/Results/SearchResults'
import Layout from '@/layouts/Layout.astro'
import { search } from '@/services/searchService'
import type { Video } from '@/types/videoTypes'

const { pathname, searchParams } = Astro.url
const query = searchParams.get('search')

if (!query) return Astro.redirect('/')

let videos: Video[] = []
try {
  videos = await search(query)
} catch (err) {
  console.error(`Error buscando "${query}" |`, err)
}
---

<Layout title={query}>
  <Menu pathname={pathname} client:load transition:persist />
  <MenuMini client:load />
  <SearchResults results={videos} client:load />
</Layout>